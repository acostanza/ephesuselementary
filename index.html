<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="resources/favicon.ico">
    <title>Ephesus Elementary School - Building Community, Nurturing Growth</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
            background: #f5f5f5;
            padding-top: 176px;
        }

        /* Hero Section - Compact Banner */
        .hero {
            background: linear-gradient(135deg, #e6031b 0%, #b8020f 100%);
            background-color: #e6031b;
            color: white;
            padding: 16px 20px 16px 170px;
            text-align: left;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            width: 100%;
        }
        
        .content-section:first-of-type {
            margin-top: 0px;
        }

        .hero h1 { font-size: 2.8rem; margin-bottom: 15px; font-weight: 700; }
        .hero .description { font-size: 1.05rem; max-width: 800px; opacity: 0.95; line-height: 1.7; }

        /* Floating Navigation */
        .floating-nav {
            position: fixed;
            left: 40px;
            top: 236px;
            z-index: 10000;
            width: 200px;
        }

        .nav-item {
            position: relative;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-item:last-child {
            margin-bottom: 0;
        }

        .nav-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ddd;
            border: 3px solid #e6031b;
            position: absolute;
            left: 0;
            top: 0;
            transition: all 0.3s ease;
            z-index: 2;
        }

        .nav-item.active .nav-dot {
            background: #e6031b;
            transform: scale(1.3);
        }

        .nav-label {
            padding-left: 35px;
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-item.active .nav-label {
            color: #e6031b;
            font-weight: 700;
        }

        .nav-item:hover .nav-label {
            color: #e6031b;
        }

        /* Path line connecting dots - exclude last nav item (expansion) */
        .nav-item:not([data-section="expansion"])::after {
            content: '';
            position: absolute;
            left: 9px;
            top: 20px;
            width: 2px;
            height: calc(100% + 10px);
            background: repeating-linear-gradient(
                to bottom,
                #e6031b 0px,
                #e6031b 8px,
                transparent 8px,
                transparent 16px
            );
            z-index: 1;
        }

        /* Sidebar Photo */
        .sidebar-photo {
            margin-top: 5px;
            width: 100%;
        }
        
        .sidebar-photo img {
            width: 125%;
            height: auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        /* Sidebar Buttons */
        .sidebar-buttons {
            position: fixed;
            left: 40px;
            bottom: 0;
            width: 200px;
            display: flex;
            flex-direction: row;
            gap: 8px;
            z-index: 10001;
        }
        
        .sidebar-button {
            background: white;
            color: #e6031b;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            text-decoration: none;
            text-align: center;
            font-weight: 600;
            font-size: 0.7425rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            flex: 1;
        }
        
        .sidebar-button:hover {
            background: #e6031b;
            color: white;
            box-shadow: 0 4px 15px rgba(230, 3, 27, 0.3);
            transform: translateY(-2px);
        }

        /* Content Sections */
        .content-section {
            padding: 60px 80px 60px 320px;
            background: transparent;
            position: relative;
            z-index: 1;
        }

        .section-card {
            background: white;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: -40px; /* Controls the vertical spacing between content boxes (1, 2, 3, 4, 5) on desktop/larger screens */
            border: 1px solid #e0e0e0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(230, 3, 27, 0.15);
        }

        /* Alternating subtle background colors */
        .content-section:nth-child(3) .section-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%);
        }

        .content-section:nth-child(4) .section-card {
            background: linear-gradient(135deg, #fef9f9 0%, #ffffff 100%);
        }

        .content-section:nth-child(5) .section-card {
            background: linear-gradient(135deg, #ffffff 0%, #f5f8fa 100%);
        }

        .content-section:nth-child(6) .section-card {
            background: linear-gradient(135deg, #fef9f9 0%, #ffffff 100%);
        }

        .content-section:nth-child(7) .section-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9faf9 100%);
        }

        .content-section h2 {
            font-size: 2.5rem;
            color: #e6031b;
            margin-bottom: 25px;
            font-weight: 700;
        }

        .content-section .section-number {
            display: inline-block;
            width: 50px;
            height: 50px;
            background: #e6031b;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 50px;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .content-section p {
            font-size: 1.1rem;
            line-height: 1.8;
            max-width: 800px;
            color: #555;
            margin-bottom: 20px;
        }

        .highlight-box {
            background: #fef9f9;
            border-left: 5px solid #e6031b;
            padding: 25px 30px;
            margin-top: 30px;
            border-radius: 10px;
            max-width: 800px;
            border: 1px solid #ffe0e0;
        }

        .highlight-box h3 {
            color: #e6031b;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .highlight-box ul {
            list-style: none;
            padding-left: 0;
        }

        .highlight-box li {
            padding: 8px 0 8px 30px;
            position: relative;
            color: #555;
        }

        .highlight-box li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #e6031b;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Stats Display */
        .stats {
            display: flex;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: #e6031b;
            color: white;
            padding: 30px;
            border-radius: 10px;
            min-width: 200px;
            box-shadow: 0 4px 15px rgba(230, 3, 27, 0.3);
        }

        .stat-card-minority {
            background: #f5c518;
            color: #333;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            display: block;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Section Divider */
        .section-divider {
            height: 2px;
            background: linear-gradient(to right, transparent, #e6031b, transparent);
            margin: 0 auto 40px auto;
            max-width: 300px;
            opacity: 0.3;
        }

        /* School Logo */
        .school-logo {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10001;
            width: 120px;
            height: auto;
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            transition: transform 0.3s ease;
        }

        .school-logo:hover {
            transform: scale(1.05);
        }

        .school-logo img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.15);
            z-index: 1500;
            padding: 10px 5px;
        }

        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 5px;
        }

        .mobile-nav-item {
            flex: 1;
            text-align: center;
            padding: 8px 5px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.3s ease;
            font-size: 0.75rem;
            color: #666;
            font-weight: 500;
        }

        .mobile-nav-item.active {
            background: #fef9f9;
            color: #e6031b;
            font-weight: 700;
        }

        .mobile-nav-item:hover {
            background: #f8f9fa;
        }

        /* Responsive Design */
        @media (max-width: 968px) {
            .floating-nav {
                display: none;
            }
            
            .sidebar-buttons {
                position: fixed;
                top: 168px;
                bottom: auto;
                left: auto;
                right: 10px;
                width: auto;
                flex-direction: row;
                gap: 6px;
                z-index: 10002;
            }
            .sidebar-button {
                padding: 5px 10px;
                font-size: 0.65rem;
            }

            .mobile-nav {
                display: block;
            }

            .school-logo {
                width: 70px;
                top: 10px;
                left: 10px;
                padding: 6px;
            }

            .hero {
                padding: 20px 15px 20px 100px;
                height: 180px;
                min-height: 180px;
                max-height: 180px;
                box-sizing: border-box;
                overflow: hidden;
            }
            .hero .description {
                display: -webkit-box;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

            .content-section:first-of-type {
                margin-top: 220px;
            }

            .content-section {
                padding-left: 20px;
                padding-right: 20px;
            }

            .content-section {
                padding-bottom: -40x; /* Controls the vertical spacing between content boxes (1, 2, 3, 4, 5) on mobile/narrow screens */
            }

            .section-card {
                padding: 25px 20px;
            }

            .hero h1 { font-size: 1.8rem; }
            .hero .description { font-size: 0.9rem; }

            .content-section h2 {
                font-size: 1.6rem;
            }

            .content-section p {
                font-size: 1rem;
            }

            .stats {
                flex-direction: column;
            }

            .stat-card {
                width: 100%;
            }

            .popup-notification {
                bottom: 80px;
                width: calc(100% - 20px);
                left: 10px;
                right: 10px;
                padding: 20px;
            }

            .popup-heading {
                font-size: 1.2rem;
            }

            .popup-text {
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .school-logo {
                width: 50px;
                top: 8px;
                left: 8px;
                padding: 5px;
            }

            .hero {
                padding: 15px 10px 15px 80px;
            }

            .content-section:first-of-type {
                margin-top: 180px;
            }

            .hero h1 { font-size: 1.5rem; }

            .content-section h2 {
                font-size: 1.4rem;
            }

            .section-card {
                padding: 20px 15px;
            }

            .mobile-nav-item {
                font-size: 0.7rem;
                padding: 6px 3px;
            }
        }

        /* Popup Notification */
        .popup-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 380px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(230, 3, 27, 0.25);
            padding: 30px;
            z-index: 3000;
            border: 2px solid #e6031b;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .popup-notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .popup-notification.hide {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        .popup-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: #e6031b;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .popup-close:hover {
            background: #b8020f;
            transform: scale(1.1);
        }

        .popup-heading {
            color: #e6031b;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 15px;
            padding-right: 20px;
            line-height: 1.3;
        }

        .popup-text {
            color: #555;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 0;
        }

        .popup-text a {
            color: #e6031b;
            text-decoration: underline;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .popup-text a:hover {
            color: #b8020f;
        }

        @media (max-width: 480px) {
            .popup-notification {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Housing Development Graphic Styles */
        .housing-graphic {
            margin: 40px 0;
        }

        .housing-graphic .main-row {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 40px;
            flex-wrap: wrap;
        }

        .housing-graphic .stat-column {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: flex-end;
        }

        .housing-graphic .stat-column.left {
            align-items: flex-end;
        }

        .housing-graphic .stat-column.right {
            align-items: flex-start;
        }

        .housing-graphic .stat-pill {
            padding: 14px 22px;
            border-radius: 50px;
            text-align: center;
            opacity: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .housing-graphic .stat-pill.affordable {
            background: #D32027;
            color: #fff;
            animation: slideFromLeft 0.5s ease-out 1.8s forwards;
        }

        .housing-graphic .stat-pill.units {
            background: linear-gradient(135deg, #F5C518 0%, #E8B708 100%);
            color: #333;
            animation: slideFromRight 0.5s ease-out 2s forwards;
        }

        .housing-graphic .stat-pill-number {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 28px;
            font-weight: 700;
            line-height: 1;
        }

        .housing-graphic .stat-pill-label {
            font-size: 12px;
            font-weight: 600;
            line-height: 1.2;
            text-align: left;
        }

        .housing-graphic .chart-container {
            position: relative;
            opacity: 0;
            animation: scaleIn 0.6s ease-out 0.3s forwards;
        }

        .housing-graphic .chart-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .housing-graphic .chart-center-number {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 48px;
            color: #2D2D2D;
            line-height: 1;
            font-weight: 700;
        }

        .housing-graphic .chart-center-label {
            font-size: 13px;
            color: #888;
            margin-top: 2px;
        }

        .housing-graphic .legend {
            display: flex;
            justify-content: flex-start;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .housing-graphic .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
        }

        .housing-graphic .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .housing-graphic .legend-text {
            font-size: 13px;
            color: #555;
        }

        .housing-graphic .legend-text strong {
            color: #2D2D2D;
        }

        .housing-graphic .planned-tag {
            font-size: 9px;
            font-weight: 700;
            color: #B8860B;
            background: #FFF8E7;
            padding: 2px 6px;
            border-radius: 8px;
            margin-left: 4px;
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes slideFromLeft {
            from { opacity: 0; transform: translateX(-25px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideFromRight {
            from { opacity: 0; transform: translateX(25px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @media (max-width: 750px) {
            .housing-graphic .main-row {
                flex-direction: column;
            }
            .housing-graphic .stat-column {
                flex-direction: row;
                align-items: center !important;
            }
        }
    </style>
</head>
<body>
    <!-- School Logo - Fixed Position -->
    <div class="school-logo">
        <img src="resources/ephesus-logo.png" alt="Ephesus Elementary School Logo">
    </div>

    <!-- Popup Notification -->
    <div class="popup-notification" id="emailPopup">
        <button class="popup-close" id="closePopup" aria-label="Close notification">×</button>
        <h3 class="popup-heading">Did you Email the School Board Yet?</h3>
        <p class="popup-text">
            Tell the School Board why Ephesus Elementary is important to <strong>YOU</strong>, and why investing in Ephesus is important! Need ideas? See our <a href="conversations.html">conversations page</a>.
        </p>
    </div>

    <!-- Hero Section -->
    <section class="hero" id="hero">
        <h1>Ephesus Elementary</h1>
        <div class="description"><b>Building Community, Nurturing Growth</b> <br>A welcoming, community-centric school where every child matters.</div>
    </section>

    <!-- Floating Navigation -->
    <nav class="floating-nav">
        <div class="nav-item active" data-section="walkability">
            <div class="nav-dot"></div>
            <div class="nav-label">Walkability</div>
        </div>
        <div class="nav-item" data-section="housing">
            <div class="nav-dot"></div>
            <div class="nav-label">Affordable Housing</div>
        </div>
        <div class="nav-item" data-section="title1">
            <div class="nav-dot"></div>
            <div class="nav-label">Title 1 Status</div>
        </div>
        <div class="nav-item" data-section="growth">
            <div class="nav-dot"></div>
            <div class="nav-label">Student Growth</div>
        </div>
        <div class="nav-item" data-section="expansion">
            <div class="nav-dot"></div>
            <div class="nav-label">Land for Expansion</div>
        </div>
        <div class="sidebar-photo">
            <img src="resources/ephesus_alert.jpg" alt="Ephesus Elementary School Community" loading="lazy">
        </div>
    </nav>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <div class="mobile-nav-items">
            <div class="mobile-nav-item active" data-section="walkability">Walk</div>
            <div class="mobile-nav-item" data-section="housing">Housing</div>
            <div class="mobile-nav-item" data-section="title1">Title 1</div>
            <div class="mobile-nav-item" data-section="growth">Growth</div>
            <div class="mobile-nav-item" data-section="expansion">Land</div>
        </div>
    </nav>

    <!-- Sidebar Buttons -->
    <div class="sidebar-buttons">
        <a href="index.html" class="sidebar-button">Home</a>
        <a href="conversations.html" class="sidebar-button">Conversations</a>
        <a href="resources.html" class="sidebar-button">Resources</a>
    </div>

    <!-- Section 1: Walkability -->
    <section class="content-section" id="walkability">
        <div class="section-card">
            <div class="section-number">1</div>
            <h2>Walkability & Accessibility</h2>
            <p>
                Ephesus Elementary is strategically located at the heart of the community, making it easily accessible for families in the neighborhood. This central location means fewer students need to be bussed to school, reducing transportation costs and environmental impact while strengthening community connections.
            </p>
            <div class="highlight-box">
                <h3>Benefits of Our Central Location</h3>
                <ul>
                    <li>Ephesus has the highest number of kids in the district living within 1/2 a mile of the school.</li>
                </ul>
                <p style="margin-top: 1rem;">Resources: <a href="resources.html#walkability" style="color: #e6031b; text-decoration: underline; font-weight: 600;">Safe Routes to School 2025</a></p>
            </div>
        </div>
    </section>

    <!-- Section 2: Affordable Housing -->
    <section class="content-section" id="housing">
        <div class="section-card">
            <div class="section-number">2</div>
            <h2>Proximity to Affordable Housing</h2>
            <p>
                Located near affordable housing developments, Ephesus Elementary serves families across all economic backgrounds. Our commitment to accessibility ensures that quality education is available to everyone in our community, regardless of their economic circumstances.
            </p>
            <p>
                This proximity allows working families to remain engaged in their children's education while maintaining their livelihoods, creating a sustainable model for community growth and stability.
            </p>
            
            <div class="housing-graphic">
                <div class="main-row">
                    <div class="stat-column left">
                        <div class="stat-pill affordable">
                            <div class="stat-pill-number">42%</div>
                            <div class="stat-pill-label">Affordable<br>Housing</div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <svg id="housing-donut" width="280" height="280"></svg>
                        <div class="chart-center">
                            <div class="chart-center-number" id="housing-centerNumber">0</div>
                            <div class="chart-center-label">Total new and coming soon housing units</div>
                        </div>
                    </div>
                    
                    <div class="stat-column right">
                        <div class="stat-pill units">
                            <div class="stat-pill-number">299</div>
                            <div class="stat-pill-label">Affordable<br>Units</div>
                        </div>
                    </div>
                </div>
                
                <div class="legend" id="housing-legend"></div>
            </div>

            <div class="highlight-box">
                <h3>Supporting Working Families</h3>
                <ul>
                    <li>These families will need a neighborhood school</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Section 3: Title 1 Status -->
    <section class="content-section" id="title1">
        <div class="section-card">
            <div class="section-number">3</div>
            <h2>Title 1 Status School</h2>
            <p>
                As a Title 1 school, Ephesus Elementary receives federal funding to support students from low-income families, ensuring every child has access to the resources they need to succeed. With 38% of our students receiving free or reduced lunch, we're committed to equity and excellence for all.
            </p>
            <div class="stats">
                <div class="stat-card stat-card-minority">
                    <span class="stat-number" id="stat-50" data-target="50">0%</span>
                    <span class="stat-label">Minority Enrollment</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="stat-38" data-target="38">0%</span>
                    <span class="stat-label">Free/Reduced Lunch</span>
                </div>
            </div>
            <div class="highlight-box">
                <h3>Title 1 Resources & Support</h3>
                <ul>
                    <li>TBD</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Section 4: Student Growth -->
    <section class="content-section" id="growth">
        <div class="section-card">
            <div class="section-number">4</div>
            <h2>Highest Student Growth Scores</h2>
            <p>
                We're proud to report the highest student growth scores in our district. This achievement reflects our dedicated teachers, supportive staff, and evidence-based instructional practices that meet every student where they are and help them reach their full potential.
            </p>
            <p>
                Our commitment to individualized learning, coupled with robust intervention programs and enrichment opportunities, ensures that every child makes meaningful progress throughout the year.
            </p>
            <div class="highlight-box">
                <h3>Our Success Factors</h3>
                <ul>
                    <li>TBD</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Section 5: Expansion -->
    <section class="content-section" id="expansion">
        <div class="section-card">
            <div class="section-number">5</div>
            <h2>Ample Land for Expansion</h2>
            <p>
                Looking toward the future, Ephesus Elementary sits on a spacious campus with ample land available for expansion. This provides the flexibility to grow alongside our community, adding facilities and programs as needed without relocating or compromising our central location.
            </p>
            <div class="highlight-box">
                <h3>Future Growth Opportunities</h3>
                <ul>
                    <li>TBD</li>
                </ul>
            </div>
        </div>
    </section>

    <script>
        // 50% stat count-up animation when Title 1 section reaches halfway up viewport
        (function() {
            const statEl = document.getElementById('stat-50');
            const section = document.getElementById('title1');
            if (!statEl || !section) return;

            let animated = false;
            const target = 50;
            const duration = 2250;

            function checkAndAnimate() {
                if (animated) return;
                const rect = section.getBoundingClientRect();
                const viewportMid = window.innerHeight / 2;
                if (rect.top <= viewportMid) {
                    animated = true;
                    let start = null;
                    function step(timestamp) {
                        if (!start) start = timestamp;
                        const elapsed = timestamp - start;
                        const progress = Math.min(elapsed / duration, 1);
                        const easeOut = 1 - Math.pow(1 - progress, 2);
                        const value = Math.round(easeOut * target);
                        statEl.textContent = value + '%';
                        if (progress < 1) requestAnimationFrame(step);
                        else statEl.textContent = target + '%';
                    }
                    requestAnimationFrame(step);
                }
            }

            window.addEventListener('scroll', checkAndAnimate, { passive: true });
            checkAndAnimate();
        })();

        // 38% stat count-up animation when Title 1 section reaches halfway up viewport
        (function() {
            const statEl = document.getElementById('stat-38');
            const section = document.getElementById('title1');
            if (!statEl || !section) return;

            let animated = false;
            const target = 38;
            const duration = 2250;

            function checkAndAnimate() {
                if (animated) return;
                const rect = section.getBoundingClientRect();
                const viewportMid = window.innerHeight / 2;
                if (rect.top <= viewportMid) {
                    animated = true;
                    let start = null;
                    function step(timestamp) {
                        if (!start) start = timestamp;
                        const elapsed = timestamp - start;
                        const progress = Math.min(elapsed / duration, 1);
                        const easeOut = 1 - Math.pow(1 - progress, 2);
                        const value = Math.round(easeOut * target);
                        statEl.textContent = value + '%';
                        if (progress < 1) requestAnimationFrame(step);
                        else statEl.textContent = target + '%';
                    }
                    requestAnimationFrame(step);
                }
            }

            window.addEventListener('scroll', checkAndAnimate, { passive: true });
            checkAndAnimate();
        })();

        // Popup notification functionality
        document.addEventListener('DOMContentLoaded', () => {
            const popup = document.getElementById('emailPopup');
            const closeBtn = document.getElementById('closePopup');
            
            // Show popup after a short delay
            setTimeout(() => {
                popup.classList.add('show');
            }, 1000);
            
            // Close popup when X is clicked
            closeBtn.addEventListener('click', () => {
                popup.classList.remove('show');
                popup.classList.add('hide');
            });
        });

        // Smooth scroll and navigation highlighting
        const sections = document.querySelectorAll('.content-section, .hero');
        const navItems = document.querySelectorAll('.nav-item');
        const mobileNavItems = document.querySelectorAll('.mobile-nav-item');

        // Update active nav item on scroll
        window.addEventListener('scroll', () => {
            let current = 'hero';
            const scrollPosition = window.scrollY + window.innerHeight / 2;

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                
                if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                    current = section.getAttribute('id');
                }
            });

            // Update desktop nav
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === current) {
                    item.classList.add('active');
                }
            });

            // Update mobile nav
            mobileNavItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === current) {
                    item.classList.add('active');
                }
            });
        });

        // Desktop navigation click
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                const sectionId = item.getAttribute('data-section');
                const section = document.getElementById(sectionId);
                
                if (section) {
                    const headerOffset = 200;
                    const elementPosition = section.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                    window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                }
            });
        });

        // Mobile navigation click
        mobileNavItems.forEach(item => {
            item.addEventListener('click', () => {
                const sectionId = item.getAttribute('data-section');
                const section = document.getElementById(sectionId);
                
                if (section) {
                    const headerOffset = 200;
                    const elementPosition = section.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                    window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                }
            });
        });

        // Housing Development Donut Chart Animation
        (function() {
            const data = [
                { name: 'Greenfield', units: 149, type: 'Affordable', color: '#D32027' },
                { name: 'Park Apartments', units: 414, type: 'Market Rate', color: '#7B1113' },
                { name: 'Longleaf Trace', units: 150, type: 'Planned', color: '#F5C518', planned: true },
            ];
            
            const totalWithPlanned = 713;
            const size = 280;
            const strokeWidth = 38;
            const radius = (size - strokeWidth) / 2;
            const circumference = 2 * Math.PI * radius;
            const svg = document.getElementById('housing-donut');
            const centerNumber = document.getElementById('housing-centerNumber');
            const legend = document.getElementById('housing-legend');
            
            if (!svg || !centerNumber || !legend) return;
            
            // Create background circle
            const bgCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            bgCircle.setAttribute('cx', size / 2);
            bgCircle.setAttribute('cy', size / 2);
            bgCircle.setAttribute('r', radius);
            bgCircle.setAttribute('fill', 'none');
            bgCircle.setAttribute('stroke', '#f0f0f0');
            bgCircle.setAttribute('stroke-width', strokeWidth);
            svg.appendChild(bgCircle);
            
            // Create segments
            let currentOffset = 0;
            data.forEach((segment, i) => {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', size / 2);
                circle.setAttribute('cy', size / 2);
                circle.setAttribute('r', radius);
                circle.setAttribute('fill', 'none');
                circle.setAttribute('stroke', segment.color);
                circle.setAttribute('stroke-width', strokeWidth);
                circle.setAttribute('stroke-linecap', 'round');
                circle.setAttribute('transform', `rotate(-90 ${size/2} ${size/2})`);
                
                const segmentLength = (segment.units / totalWithPlanned) * circumference;
                circle.style.strokeDasharray = `0 ${circumference}`;
                circle.style.strokeDashoffset = -currentOffset;
                circle.style.transition = 'stroke-dasharray 0.8s ease-out';
                circle.dataset.target = segmentLength;
                
                svg.appendChild(circle);
                currentOffset += segmentLength;
            });
            
            // Create legend
            data.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'legend-item';
                div.innerHTML = `
                    <div class="legend-dot" style="background: ${item.color};"></div>
                    <div class="legend-text">
                        <strong>${item.name}</strong> · ${item.units} units${item.planned ? '<span class="planned-tag">PLANNED</span>' : ''}
                    </div>
                `;
                legend.appendChild(div);
                
                setTimeout(() => {
                    div.style.opacity = '1';
                    div.style.transition = 'opacity 0.4s ease-out';
                }, 1800 + i * 150);
            });
            
            // Animate chart when section is visible
            const housingSection = document.getElementById('housing');
            if (!housingSection) return;
            
            let animated = false;
            function checkAndAnimate() {
                if (animated) return;
                const rect = housingSection.getBoundingClientRect();
                const viewportMid = window.innerHeight / 2;
                if (rect.top <= viewportMid) {
                    animated = true;
                    
                    setTimeout(() => {
                        const circles = svg.querySelectorAll('circle:not(:first-child)');
                        circles.forEach((circle, i) => {
                            setTimeout(() => {
                                const target = parseFloat(circle.dataset.target);
                                circle.style.strokeDasharray = `${target} ${circumference}`;
                            }, i * 400);
                        });
                        
                        // Animate center number
                        const duration = 2000;
                        const startTime = Date.now();
                        const animate = () => {
                            const elapsed = Date.now() - startTime;
                            const progress = Math.min(elapsed / duration, 1);
                            const eased = 1 - Math.pow(1 - progress, 3);
                            centerNumber.textContent = Math.round(totalWithPlanned * eased);
                            if (progress < 1) requestAnimationFrame(animate);
                        };
                        animate();
                    }, 800);
                }
            }
            
            window.addEventListener('scroll', checkAndAnimate, { passive: true });
            checkAndAnimate();
        })();
    </script>
</body>
</html>
